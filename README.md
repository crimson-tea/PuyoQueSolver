# PuyoQueSolver
最大れんさを高速に計算するアプリケーションです。

## デモ動画
アップロード予定  

## PuyoQueSolver について
なぞる長さ(以下長さ)が5の場合、11924通りしかありません。  
これくらいならば全探索できますね。  
では、もっと長くなったときはどうなるでしょうか。  
より長いながさを現実的な時間で計算ができるようにビットボードでの高速化に挑戦しました。  
結果、素朴な int[][] での実装と比べ4-5倍ほどの高速化を達成しました。
これは、長さを1長くしても同等の時間で計算ができることを意味します。

## システム要件
* Windows 10 64ビット 以上
* .NET 6.0 以上
* AVX2 の利用が可能なCPU

## 工夫
1. 盤面をビットボードで表現しました。
    * AVX2 を活用しています。
2. 有効ななぞり方を重複無しで事前に列挙しました。

## ベンチマーク
環境  
CPU: i7-4790  
シングルスレッドにて計測  

|長さ|素朴な実装 処理時間(sec)|高速化実装 処理時間(sec)|
|---|---|---|
|5|0.0308|0.0167|
|6|0.1032|0.0808|
|7|2.1241|0.3686|
|8|8.1665|1.7098|

<Sub>※少々雑に計測していますが概ねの傾向はみて取れますね。</Sub>

## なぞる長さと有効ななぞり方の数
気になったのでなぞり方の数を表にしました。
|なぞる長さ|有効ななぞり方|
|---|---|
|1|48|
|2|152|
|3|604|
|4|2631|
|5|11924|
|6|54788|
|7|249964|
|8|1118224|
|9|4862356|
|10|20401322|

## やりたいこと
現在は横型ビットボードで、各状態に ulong 変数一つを割り当てて実装している。  
これより効率の良いビットボードを実装する。  
縦型ビットボードにする。  
→ pext と pdep で効率よく落下をシミュレートできるはず。  
一つの ulong を1ビットに見立て3つのボードで8種類の状態を表現する。  
→ 省メモリになりコピーが高速になるはず。
